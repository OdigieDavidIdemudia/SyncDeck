============================= test session starts =============================
platform win32 -- Python 3.13.3, pytest-9.0.1, pluggy-1.6.0
rootdir: C:\Users\DELL\.gemini\antigravity\scratch\task_tracker
plugins: anyio-4.9.0
collected 13 items / 12 deselected / 1 selected

backend\tests\test_teams.py F                                            [100%]

================================== FAILURES ===================================
_________________________ test_assign_team_and_limit __________________________

client = <starlette.testclient.TestClient object at 0x000002932207E660>

    def test_assign_team_and_limit(client):
        token = test_login_group_head(client)
        headers = {"Authorization": f"Bearer {token}"}
    
        team_id = test_create_team(client)
    
        # Create 3 users
        for i in range(3):
            client.post(
                "/users/",
                json={"username": f"user_{i}", "password": "password", "role": "member"},
                headers=headers
            )
    
        # Get user IDs (assuming 2, 3, 4 etc. since admin is 1)
        # Actually, let's fetch them to be sure
        users = client.get("/users/", headers=headers).json()
        user_ids = [u["id"] for u in users if u["username"].startswith("user_")]
    
        # Promote 1st to UH of Team Alpha
        response = client.put(
            f"/users/{user_ids[0]}",
            json={"role": "unit_head", "team_id": team_id},
            headers=headers
        )
        assert response.status_code == 200
    
        # Promote 2nd to UH of Team Alpha
        response = client.put(
            f"/users/{user_ids[1]}",
            json={"role": "unit_head", "team_id": team_id},
            headers=headers
        )
        assert response.status_code == 200
    
        # Promote 3rd to UH of Team Alpha - SHOULD FAIL
        response = client.put(
            f"/users/{user_ids[2]}",
            json={"role": "unit_head", "team_id": team_id},
            headers=headers
        )
        assert response.status_code == 400
>       assert "maximum" in response.json()["detail"]
E       AssertionError: assert 'maximum' in 'Team already has 2 Unit Heads.'

backend\tests\test_teams.py:59: AssertionError
---------------------------- Captured stderr call -----------------------------
INFO:httpx:HTTP Request: POST http://testserver/token "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://testserver/token "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://testserver/teams/ "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://testserver/users/ "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://testserver/users/ "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://testserver/users/ "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET http://testserver/users/ "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: PUT http://testserver/users/2 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: PUT http://testserver/users/3 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: PUT http://testserver/users/4 "HTTP/1.1 400 Bad Request"
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/token "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/token "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/teams/ "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/users/ "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/users/ "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/users/ "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/users/ "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: PUT http://testserver/users/2 "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: PUT http://testserver/users/3 "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: PUT http://testserver/users/4 "HTTP/1.1 400 Bad Request"
============================== warnings summary ===============================
backend\database.py:22
  C:\Users\DELL\.gemini\antigravity\scratch\task_tracker\backend\database.py:22: MovedIn20Warning: The ``declarative_base()`` function is now available as sqlalchemy.orm.declarative_base(). (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    Base = declarative_base()

backend\schemas.py:22
  C:\Users\DELL\.gemini\antigravity\scratch\task_tracker\backend\schemas.py:22: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class User(UserBase):

..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_config.py:383
  C:\Users\DELL\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_config.py:383: UserWarning: Valid config keys have changed in V2:
  * 'orm_mode' has been renamed to 'from_attributes'
    warnings.warn(message, UserWarning)

backend\schemas.py:39
  C:\Users\DELL\.gemini\antigravity\scratch\task_tracker\backend\schemas.py:39: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class Team(TeamBase):

backend\schemas.py:52
  C:\Users\DELL\.gemini\antigravity\scratch\task_tracker\backend\schemas.py:52: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class Comment(CommentBase):

backend\schemas.py:69
  C:\Users\DELL\.gemini\antigravity\scratch\task_tracker\backend\schemas.py:69: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TaskActivity(TaskActivityBase):

backend\schemas.py:85
  C:\Users\DELL\.gemini\antigravity\scratch\task_tracker\backend\schemas.py:85: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class HelpRequest(HelpRequestBase):

backend\schemas.py:103
  C:\Users\DELL\.gemini\antigravity\scratch\task_tracker\backend\schemas.py:103: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class MemberAchievement(MemberAchievementBase):

backend\schemas.py:116
  C:\Users\DELL\.gemini\antigravity\scratch\task_tracker\backend\schemas.py:116: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    @validator('progress_percentage')

backend\schemas.py:127
  C:\Users\DELL\.gemini\antigravity\scratch\task_tracker\backend\schemas.py:127: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TaskProgressUpdate(TaskProgressUpdateBase):

backend\schemas.py:152
  C:\Users\DELL\.gemini\antigravity\scratch\task_tracker\backend\schemas.py:152: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class Task(TaskBase):

backend/tests/test_teams.py::test_assign_team_and_limit
backend/tests/test_teams.py::test_assign_team_and_limit
  C:\Users\DELL\.gemini\antigravity\scratch\task_tracker\backend\auth.py:38: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    expire = datetime.utcnow() + timedelta(minutes=15)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED backend/tests/test_teams.py::test_assign_team_and_limit - AssertionErr...
================ 1 failed, 12 deselected, 13 warnings in 1.00s ================
